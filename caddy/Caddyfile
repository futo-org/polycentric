{
    cache {
        allowed_http_verbs GET
        api {
            basepath /cache-api
            prometheus
        }
        badger {
            path /data/cache/badger
        }
        # Match Cache-Control from origin
        ttl {
            default 0s
        }
        # Maximum size for cacheable responses (500KB to be safe)
        max_cacheable_body_bytes 512000
        # Ensure detailed cache status headers
        status_header
        status_header_detail
    }
}

srv1.polycentric.io {
    cache
    
    # Protect cache API endpoint
    @cache_api path /cache-api/*
    handle @cache_api {
        # Only allow internal access
        @internal remote_ip private_ranges
        handle @internal {
            # Don't proxy cache API requests - let Caddy handle them
            rewrite * {path}
        }
        respond 403
    }

    reverse_proxy http://server:8081
}

